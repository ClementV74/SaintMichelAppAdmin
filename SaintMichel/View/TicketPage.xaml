<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="SaintMichel.View.TicketPage"
             Title="TicketPage"
                          BackgroundColor="{AppThemeBinding Light=#F8F9FA, Dark=#212529}">

    <Grid RowDefinitions="Auto,*">
        <!-- Header -->
        <Grid Grid.Row="0" Padding="20,15" BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#343A40}" 
              Shadow="{Shadow Offset='0,5', Opacity=0.1, Radius=10, Brush=#000000}">
            <Label Text="Mes Tickets" FontSize="24" FontAttributes="Bold" 
                   TextColor="{AppThemeBinding Light=#212529, Dark=#F8F9FA}" 
                   HorizontalOptions="Start" VerticalOptions="Center" />

            <Button Grid.Column="1" Text="+" FontSize="20" FontAttributes="Bold"
                    BackgroundColor="#4361EE" TextColor="White" CornerRadius="20"
                    WidthRequest="40" HeightRequest="40" Padding="0"
                    HorizontalOptions="End" VerticalOptions="Center" />
        </Grid>

        <!-- Tickets List -->
        <RefreshView Grid.Row="1">
            <CollectionView ItemsSource="{Binding Ticketsitems}"
                            SelectionMode="Single"
                            SelectionChanged="OnTicketSelected"
                            Margin="10,5">
                <CollectionView.EmptyView>
                    <VerticalStackLayout VerticalOptions="Center" HorizontalOptions="Center">
                        <Label Text="Aucun ticket trouvé" FontSize="18" TextColor="Gray" 
                               HorizontalOptions="Center" Margin="0,20,0,0" />
                    </VerticalStackLayout>
                </CollectionView.EmptyView>

                <CollectionView.ItemsLayout>
                    <LinearItemsLayout Orientation="Vertical" ItemSpacing="12" />
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Padding="0" HasShadow="True" CornerRadius="10" 
                               BorderColor="Transparent"
                               BackgroundColor="{AppThemeBinding Light=#FFFFFF, Dark=#343A40}">
                            <Grid ColumnDefinitions="Auto,*" RowDefinitions="Auto,Auto,Auto" Padding="15">
                                <!-- Status Indicator - Now wider and more visible -->
                                <Border Grid.RowSpan="3" WidthRequest="10" Margin="0,0,15,0"
                                        BackgroundColor="{Binding StatusColor}"
                                        StrokeThickness="0"
                                        StrokeShape="RoundRectangle 5,5,5,5" />

                                <!-- Ticket Content -->
                                <Grid Grid.Column="1" Grid.Row="0" ColumnDefinitions="*,Auto">
                                    <Label Text="{Binding titre}" 
                                           FontAttributes="Bold" FontSize="18" 
                                           TextColor="{AppThemeBinding Light=#212529, Dark=#F8F9FA}"
                                           VerticalOptions="Center" />

                                    <!-- Status Badge - Now at top right for better visibility -->
                                    <Border Grid.Column="1" 
                                            BackgroundColor="{Binding StatusColor}"
                                            StrokeThickness="0"
                                            Padding="10,5" 
                                            StrokeShape="RoundRectangle 15,15,15,15">
                                        <Label Text="{Binding StatusText}" 
                                               FontSize="13" FontAttributes="Bold"
                                               TextColor="White" />
                                    </Border>
                                </Grid>

                                <Label Grid.Column="1" Grid.Row="1" 
                                       Text="{Binding description}" 
                                       FontSize="14" LineBreakMode="TailTruncation" MaxLines="2"
                                       TextColor="{AppThemeBinding Light=#6C757D, Dark=#CED4DA}"
                                       Margin="0,12,0,10" />

                                <Grid Grid.Column="1" Grid.Row="2" ColumnDefinitions="Auto,*,Auto">
                                    <!-- Date (if available) -->
                                    <Label Grid.Column="2" 
                                           Text="{Binding DateCreation, StringFormat='{0:dd/MM/yyyy}'}" 
                                           FontSize="12" TextColor="{AppThemeBinding Light=#6C757D, Dark=#ADB5BD}"
                                           VerticalOptions="Center"
                                           IsVisible="{Binding DateCreation, Converter={StaticResource NullToBoolConverter}}" />
                                </Grid>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </RefreshView>

        <!-- Légende des statuts (en bas de l'écran) -->
        <Border Grid.Row="1" VerticalOptions="End" HorizontalOptions="Center"
                Margin="0,0,0,15" Padding="15,8"
                BackgroundColor="{AppThemeBinding Light=White, Dark=#343A40}"
                StrokeThickness="0"
                StrokeShape="RoundRectangle 20,20,20,20"
                Shadow="{Shadow Offset='0,4', Opacity=0.15, Radius=8, Brush=#000000}">
            <HorizontalStackLayout Spacing="15">
                <!-- Répétez pour chaque statut possible -->
                <HorizontalStackLayout Spacing="5">
                    <BoxView Color="#4361EE" WidthRequest="10" HeightRequest="10" CornerRadius="5" VerticalOptions="Center" />
                    <Label Text="En attente" FontSize="12" VerticalOptions="Center" />
                </HorizontalStackLayout>

                <HorizontalStackLayout Spacing="5">
                    <BoxView Color="#FF9F1C" WidthRequest="10" HeightRequest="10" CornerRadius="5" VerticalOptions="Center" />
                    <Label Text="En cours" FontSize="12" VerticalOptions="Center" />
                </HorizontalStackLayout>

                <HorizontalStackLayout Spacing="5">
                    <BoxView Color="#2EC4B6" WidthRequest="10" HeightRequest="10" CornerRadius="5" VerticalOptions="Center" />
                    <Label Text="Terminé" FontSize="12" VerticalOptions="Center" />
                </HorizontalStackLayout>

                <HorizontalStackLayout Spacing="5">
                    <BoxView Color="#E71D36" WidthRequest="10" HeightRequest="10" CornerRadius="5" VerticalOptions="Center" />
                    <Label Text="Annulé" FontSize="12" VerticalOptions="Center" />
                </HorizontalStackLayout>
            </HorizontalStackLayout>
        </Border>
    </Grid>
</ContentPage>